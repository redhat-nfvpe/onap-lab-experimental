# Used by "openstack overcloud node import"
# Note: This file is often named "instackenv" and is often in JSON rather than YAML
# See: https://docs.openstack.org/tripleo-docs/latest/install/environments/baremetal.html#instackenv

nodes:

- name: controller
  _comment: virtual machine on hypervisor
  capabilities: profile:control,boot_option:local
  mac: [ "$CONTROLLER_MAC_ADDRESS" ]
  pm_type: ipmi
  pm_addr: 192.168.122.1
  pm_port: $CONTROLLER_VIRTUALBMC_PORT
  pm_user: "$VIRTUALBMC_USERNAME"
  pm_password: "$VIRTUALBMC_PASSWORD"

- name: compute-0
  _comment: virtual machine on hypervisor
  capabilities: profile:compute,boot_option:local
  mac: [ "$COMPUTE_MAC_ADDRESS" ]
  pm_type: ipmi
  pm_addr: 192.168.122.1
  pm_port: $COMPUTE_VIRTUALBMC_PORT
  pm_user: "$VIRTUALBMC_USERNAME"
  pm_password: "$VIRTUALBMC_PASSWORD"

# - name: compute-0
#   _comment: bare metal
#   capabilities: profile:compute,boot_option:local,boot_mode:uefi
#   mac: [ "$COMPUTE_MAC_ADDRESS" ]
#   pm_type: manual-management

# By default the maximum resources reported by introspection will be available for provisioning.
# It's possible to override these limits as well as other introspection data:

  #cpu: 6
  #memory: 4096 # MiB
  #disk: 100 # GiB
  #arch: x86_64

# No IPMI? No problem! Use "pm_type: manual-management", keep track of the node state (via
# "watch openstack baremetal node list") and turn the power on and off yourself.

# UEFI could be tricky. If your machine *only* supports UEFI then introspection would detect this
# and then the operating system would be deployed in UEFI mode. However, many machines use UEFI but
# for network boot (PXE) only support BIOS mode (via CSM). This means that introspection would
# detect them as BIOS instead of UEFI and the operating system would be installed in BIOS mode. It
# would then fail to boot from disk. If this is your situation (UEFI with BIOS-only network boot)
# then you should set your machine to use BIOS *only*.

# TODO
# For UEFI machines make sure to add "boot_mode:uefi" to capabilities, otherwise they will fail
# to boot after provisioned:
# https://docs.openstack.org/tripleo-docs/latest/install/advanced_deployment/uefi_boot.html

